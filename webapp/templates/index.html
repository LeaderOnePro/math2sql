<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math2SQL</title>
    <!-- Pico.css for minimal styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        :root {
            /* Base Colors - Sticking to monochrome */
            --color-black: #1f1f1f; /* Slightly softer black for text */
            --color-white: #FFFFFF;
            --color-gray-background: #f7f7f7; /* Very light gray for body background */
            --color-gray-light: #F0F0F0;      /* Lighter gray for code block */
            --color-gray-medium-light: #EAEAEA;
            --color-gray-medium: #C0C0C0;     /* Silver - For input borders */
            --color-gray-button: #E0E0E0;   /* Button background (淡墨灰色 - light ink gray) */
            --color-gray-button-hover: #D0D0D0;
            --color-gray-focus: #A0A0A0;      /* Darker Gray - for focus elements */

            /* Enhanced shadow for more elevation */
            --custom-card-shadow: 0 12px 28px rgba(0, 0, 0, 0.08), 0 6px 12px rgba(0, 0, 0, 0.06);
            --custom-card-border-radius: 0.7rem; 

            /* Font stack prioritizing common Chinese sans-serif fonts */
            --font-family-sans-serif: "PingFang SC", "Microsoft YaHei", "Helvetica Neue", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        }

        body {
            background-color: var(--color-gray-background);
            margin: 0;
            min-height: 100vh; /* Ensure full viewport height */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 1vh; /* Further reduced top padding to minimize top blank space */
            align-items: center;
            color: var(--color-black);
            font-family: var(--font-family-sans-serif);
            overflow-y: hidden; /* Prevent body scrolling */
        }

        main.container {
            max-width: 1600px; /* Even wider card for better proportion on large screens */
            width: 90%; /* Responsive width for larger screens */
            height: auto; /* Allow height to adapt to content */
            min-height: 50vh; /* Reduced minimum height for tighter layout */
            margin-top: 1vh; /* Minimal top margin to reduce blank space */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
        }

        article {
            background-color: var(--color-white);
            border-radius: var(--custom-card-border-radius);
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.09), 0 8px 14px rgba(0, 0, 0, 0.07); /* Enhanced shadow for depth */
            border: 1px solid var(--color-gray-medium-light);
            padding: 1.2em 1.5em; /* Slightly reduced vertical padding for tighter layout */
            max-height: 90vh; /* Slightly increased to allow more content visibility */
            overflow-y: auto; /* Allow scrolling inside card if needed */
            display: flex;
            flex-direction: column;
            width: 100%; /* Ensure full width of container */
        }

        article > header {
            display: none; /* Hide header to remove hat effect */
        }

        h1 {
            text-align: center;
            margin-bottom: 0.3em; /* Reduced margin for tighter connection with content */
            color: var(--color-black);
            font-weight: 700; /* Bolder for prominence */
            font-size: 1.8em; /* Larger font for prominence */
        }
        h2 {
            color: var(--color-black);
            font-size: 1.1em; /* Slightly larger font */
            font-weight: 500;
            margin-top: 1.2em; /* Adjusted for consistent spacing */
            margin-bottom: 0.5em; /* Reduced for tighter spacing */
            align-self: flex-start; /* Ensure left alignment */
        }

        label {
            font-weight: 500;
            margin-bottom: 0.3em; /* Reduced for tighter label-to-input spacing */
            color: var(--color-black);
            display: block;
            align-self: flex-start; /* Ensure left alignment */
        }

        input[type="text"], select {
            background-color: var(--color-white);
            border: 1px solid var(--color-gray-medium);
            color: var(--color-black);
            margin-bottom: 0.8em; /* Reduced for consistent vertical rhythm */
            font-family: var(--font-family-sans-serif); /* Ensure form elements use the new font */
            padding: 0.6em; /* Slightly increased padding */
            width: 100%; /* Full width for form elements */
            box-sizing: border-box; /* Ensure padding is included in width */
        }
        input[type="text"]:focus, select:focus {
            border-color: var(--color-gray-focus);
            box-shadow: 0 0 0 2px rgba(160, 160, 160, 0.25); /* Adjusted focus glow */
            --pico-form-element-focus-color: var(--color-gray-focus) !important; 
        }
        
        button[type="button"] {
            background-color: #4a90e2; /* Primary blue color for visibility */
            color: var(--color-white); /* White text for contrast */
            border: 1px solid #3a80d2; /* Slightly darker border */
            font-weight: 500;
            width: 100%; /* Full width button */
            padding: 0.7em 1em; /* Comfortable padding */
            font-family: var(--font-family-sans-serif);
            margin-top: 0.8em; /* Consistent spacing above button */
            margin-bottom: 1.2em; /* Reduced slightly for tighter layout but still separated */
            cursor: pointer; /* Indicate clickable */
            transition: background-color 0.2s; /* Smooth hover transition */
        }
        button[type="button"]:hover {
            background-color: #3a80d2; /* Darker blue on hover */
            border-color: #2a70c2;
        }

        pre#result_sql {
            background-color: var(--color-gray-light);
            border: 1px dashed var(--color-gray-medium); /* Dashed border for empty state */
            padding: 0.8em 1em; /* Adjusted padding for content breathing room */
            border-radius: var(--pico-border-radius);
            min-height: 100px; /* Reasonable minimum height */
            max-height: 200px; /* Limit height to prevent overflow */
            color: var(--color-black);
            font-family: Consolas, "Courier New", monospace; /* Keep code block monospaced */
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.9em; /* Readable font size */
            overflow-y: auto; /* Scroll inside if content is too long */
            position: relative; /* For pseudo-element positioning */
        }
        pre#result_sql::before {
            content: "转换后的 SQL 将在此处显示";
            color: var(--color-gray-medium); /* Even lighter color for subtlety */
            font-style: italic;
            font-size: 0.8em; /* Smaller font for placeholder */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block;
            text-align: center;
            pointer-events: none; /* Ensure it doesn't interfere with interaction */
        }
        pre#result_sql:not(:empty)::before {
            display: none; /* Hide placeholder when content exists */
        }
        /* Custom scrollbar for result area */
        pre#result_sql::-webkit-scrollbar {
            width: 8px; /* Slim scrollbar */
        }
        pre#result_sql::-webkit-scrollbar-track {
            background: var(--color-gray-background); /* Track color */
        }
        pre#result_sql::-webkit-scrollbar-thumb {
            background: var(--color-gray-medium); /* Thumb color */
            border-radius: 4px; /* Rounded thumb */
        }
        pre#result_sql::-webkit-scrollbar-thumb:hover {
            background: var(--color-gray-focus); /* Darker on hover */
        }

        .error-message {
            color: var(--color-black);
            font-weight: bold;
            margin-top: 0.5em; /* Reduced for tighter spacing */
            font-size: 0.95em;
            align-self: flex-start; /* Ensure left alignment */
        }

        /* Container for form elements to ensure consistent padding */
        form#math2sql_form > div {
            padding: 0 1em; /* Breathing room for form content */
            display: flex;
            flex-direction: column;
            align-items: stretch; /* Ensure children stretch to full width */
        }
        #result_sql_container {
            padding: 0 1em; /* Consistent padding with form elements */
            display: flex;
            flex-direction: column;
        }

        /* Optional: Style for KBD elements if kept, or remove them from HTML for cleaner look */
        kbd {
            background-color: var(--pico-muted-background-color, #f9fafb);
            border: 1px solid var(--pico-muted-border-color, #e5e7eb);
            border-bottom-width: 2px;
            padding: 0.2em 0.4em;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <main class="container">
        <article>
            <h1>数学公式转 SQL</h1>
            
            <form id="math2sql_form">
                <div>
                    <label for="math_expression">数学公式</label>
                    <input type="text" id="math_expression" name="math_expression" placeholder="例如: sin(x)^2 + cos(y)^2" required>
                </div>
                <div>
                    <label for="sql_dialect">选择 SQL 方言</label>
                    <select id="sql_dialect" name="sql_dialect" required>
                        <option value="postgresql" selected>PostgreSQL</option>
                        <option value="mysql">MySQL</option>
                        <!-- Add other dialects as they are supported -->
                    </select>
                </div>
                <div>
                    <button type="button" onclick="convertToSQL()">转换查询</button>
                </div>
            </form>
            
            <div id="result_sql_container">
                <h2>生成的 SQL</h2>
                <pre id="result_sql">SQL 输出将在此显示...</pre>
                <p id="error_message" class="error-message"></p>
            </div>
        </article>
    </main>

    <script>
        async function convertToSQL() {
            const expressionInput = document.getElementById('math_expression');
            const dialectSelect = document.getElementById('sql_dialect');
            const resultP = document.getElementById('result_sql');
            const errorP = document.getElementById('error_message');

            const expression = expressionInput.value;
            const dialect = dialectSelect.value;

            resultP.textContent = '正在转换中...';
            errorP.textContent = '';

            if (!expression) {
                resultP.textContent = '请输入数学公式。';
                expressionInput.focus();
                return;
            }

            try {
                const response = await fetch('/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        expression: expression, 
                        dialect: dialect 
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    resultP.textContent = data.sql_query;
                } else {
                    resultP.textContent = '转换失败。';
                    errorP.textContent = data.error || '发生未知错误。';
                }
            } catch (error) {
                console.error('Error during conversion:', error);
                resultP.textContent = '转换过程中发生错误。';
                errorP.textContent = '无法连接到服务器或发生脚本错误。请检查浏览器控制台获取更多信息。';
            }
        }

        document.getElementById('math2sql_form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent actual form submission
            convertToSQL();
        });

        // Optional: submit on enter in expression field
        // document.getElementById('math_expression').addEventListener('keypress', function(event) {
        //     if (event.key === 'Enter') {
        //         event.preventDefault(); 
        //         convertToSQL();
        //     }
        // });
    </script>
</body>
</html> 