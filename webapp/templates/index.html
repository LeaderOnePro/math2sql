<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math2SQL</title>
    <!-- Pico.css for minimal styling -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <style>
        :root {
            /* Base Colors - Sticking to monochrome */
            --color-black: #1f1f1f; /* Slightly softer black for text */
            --color-white: #FFFFFF;
            --color-gray-background: #f7f7f7; /* Very light gray for body background */
            --color-gray-light: #F0F0F0;      /* Lighter gray for code block */
            --color-gray-medium-light: #EAEAEA;
            --color-gray-medium: #C0C0C0;     /* Silver - For input borders */
            --color-gray-button: #E0E0E0;   /* Button background (淡墨灰色 - light ink gray) */
            --color-gray-button-hover: #D0D0D0;
            --color-gray-focus: #A0A0A0;      /* Darker Gray - for focus elements */

            /* Enhanced shadow for more elevation */
            --custom-card-shadow: 0 12px 28px rgba(0, 0, 0, 0.08), 0 6px 12px rgba(0, 0, 0, 0.06);
            --custom-card-border-radius: 0.7rem; 

            /* Font stack prioritizing common Chinese sans-serif fonts */
            --font-family-sans-serif: "PingFang SC", "Microsoft YaHei", "Helvetica Neue", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
        }

        body {
            background-color: var(--color-gray-background);
            margin: 0;
            min-height: 100vh; /* Ensure full viewport height */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--color-black);
            font-family: var(--font-family-sans-serif);
            overflow-y: hidden; /* Prevent body scrolling */
        }

        main.container {
            max-width: 1000px; /* Significantly wider card for a horizontal layout */
            width: 95%; /* Responsive width, slightly wider */
            height: 80vh; /* Reduced height to emphasize horizontal design */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        article {
            background-color: var(--color-white);
            border-radius: var(--custom-card-border-radius);
            box-shadow: 0 14px 30px rgba(0, 0, 0, 0.09), 0 8px 14px rgba(0, 0, 0, 0.07); /* Enhanced shadow for depth */
            border: 1px solid var(--color-gray-medium-light);
            padding: 1.2em 2.5em; /* Reduced vertical padding, increased horizontal padding for wider look */
            max-height: 75vh; /* Reduced height limit for a wider, shorter card */
            overflow-y: auto; /* Allow scrolling inside card if needed */
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            margin-bottom: 1.2em; /* Reduced margin */
            color: var(--color-black);
            font-weight: 600;
            font-size: 1.6em; /* Slightly smaller font */
        }
        h2 {
            color: var(--color-black);
            font-size: 1em; /* Smaller font */
            font-weight: 500;
            margin-top: 1em; /* Reduced space above h2 */
            margin-bottom: 0.5em;
        }

        label {
            font-weight: 500;
            margin-bottom: 0.3em; /* Reduced margin */
            color: var(--color-black);
            display: block;
        }

        input[type="text"], select {
            background-color: var(--color-white);
            border: 1px solid var(--color-gray-medium);
            color: var(--color-black);
            margin-bottom: 0.8em; /* Reduced margin */
            font-family: var(--font-family-sans-serif); /* Ensure form elements use the new font */
            padding: 0.5em; /* Reduced padding */
        }
        input[type="text"]:focus, select:focus {
            border-color: var(--color-gray-focus);
            box-shadow: 0 0 0 2px rgba(160, 160, 160, 0.25); /* Adjusted focus glow */
            --pico-form-element-focus-color: var(--color-gray-focus) !important; 
        }
        
        button[type="button"] {
            background-color: var(--color-gray-button);
            color: var(--color-black);
            border: 1px solid var(--color-gray-button);
            font-weight: 500;
            width: 100%;
            padding: 0.5em 1em; /* Reduced padding */
            font-family: var(--font-family-sans-serif);
            margin-top: 0.3em; /* Reduced space above button */
        }
        button[type="button"]:hover {
            background-color: var(--color-gray-button-hover);
            border-color: var(--color-gray-button-hover);
        }

        pre#result_sql {
            background-color: var(--color-gray-light);
            border: 1px solid var(--color-gray-medium-light);
            padding: 0.8em; /* Reduced padding */
            border-radius: var(--pico-border-radius);
            min-height: 80px; /* Reduced min-height */
            max-height: 150px; /* Limit height to prevent overflow */
            color: var(--color-black);
            font-family: Consolas, "Courier New", monospace; /* Keep code block monospaced */
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.85em; /* Smaller font */
            overflow-y: auto; /* Scroll inside if content is too long */
        }

        .error-message {
            color: var(--color-black);
            font-weight: bold;
            margin-top: 0.7em;
            font-size: 0.95em;
        }

        /* Optional: Style for KBD elements if kept, or remove them from HTML for cleaner look */
        kbd {
            background-color: var(--pico-muted-background-color, #f9fafb);
            border: 1px solid var(--pico-muted-border-color, #e5e7eb);
            border-bottom-width: 2px;
            padding: 0.2em 0.4em;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <main class="container">
        <article>
            <header>
                <h1>数学公式转 SQL</h1>
            </header>
            
            <form id="math2sql_form">
                <label for="math_expression">数学公式</label>
                <input type="text" id="math_expression" name="math_expression" placeholder="例如: sin(x)^2 + cos(y)^2" required>
                
                <label for="sql_dialect">选择 SQL 方言</label>
                <select id="sql_dialect" name="sql_dialect" required>
                    <option value="postgresql" selected>PostgreSQL</option>
                    <option value="mysql">MySQL</option>
                    <!-- Add other dialects as they are supported -->
                </select>
                
                <button type="button" onclick="convertToSQL()">转换查询</button>
            </form>
            
            <div id="result_sql_container">
                <h2>生成的 SQL</h2>
                <pre id="result_sql">SQL 输出将在此显示...</pre>
                <p id="error_message" class="error-message"></p>
            </div>
        </article>
    </main>

    <script>
        async function convertToSQL() {
            const expressionInput = document.getElementById('math_expression');
            const dialectSelect = document.getElementById('sql_dialect');
            const resultP = document.getElementById('result_sql');
            const errorP = document.getElementById('error_message');

            const expression = expressionInput.value;
            const dialect = dialectSelect.value;

            resultP.textContent = '正在转换中...';
            errorP.textContent = '';

            if (!expression) {
                resultP.textContent = '请输入数学公式。';
                expressionInput.focus();
                return;
            }

            try {
                const response = await fetch('/convert', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        expression: expression, 
                        dialect: dialect 
                    }),
                });

                const data = await response.json();

                if (response.ok) {
                    resultP.textContent = data.sql_query;
                } else {
                    resultP.textContent = '转换失败。';
                    errorP.textContent = data.error || '发生未知错误。';
                }
            } catch (error) {
                console.error('Error during conversion:', error);
                resultP.textContent = '转换过程中发生错误。';
                errorP.textContent = '无法连接到服务器或发生脚本错误。请检查浏览器控制台获取更多信息。';
            }
        }

        document.getElementById('math2sql_form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent actual form submission
            convertToSQL();
        });

        // Optional: submit on enter in expression field
        // document.getElementById('math_expression').addEventListener('keypress', function(event) {
        //     if (event.key === 'Enter') {
        //         event.preventDefault(); 
        //         convertToSQL();
        //     }
        // });
    </script>
</body>
</html> 